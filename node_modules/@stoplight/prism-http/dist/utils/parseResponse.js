"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const type_is_1 = require("type-is");
const Either = require("fp-ts/lib/Either");
const TaskEither = require("fp-ts/lib/TaskEither");
const lodash_1 = require("lodash");
const pipeable_1 = require("fp-ts/lib/pipeable");
function parseResponseBody(response) {
    return TaskEither.tryCatch(() => type_is_1.is(response.headers.get('content-type') || '', ['application/json', 'application/*+json'])
        ? response.json()
        : response.text(), Either.toError);
}
exports.parseResponseBody = parseResponseBody;
function parseResponseHeaders(response) {
    return lodash_1.mapValues(response.headers.raw(), hValue => hValue.join(' '));
}
exports.parseResponseHeaders = parseResponseHeaders;
function parseResponse(response) {
    return pipeable_1.pipe(parseResponseBody(response), TaskEither.map(body => ({
        statusCode: response.status,
        headers: parseResponseHeaders(response),
        body,
    })));
}
exports.parseResponse = parseResponse;
