"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const types_1 = require("./types");
const variableRegexp = /{(.*?)}/g;
function matchBaseUrl(server, baseUrl) {
    const templateMatchResult = matchRequestUrlToTemplateUrl(baseUrl, server.url, server.variables);
    if (!templateMatchResult) {
        return types_1.MatchType.NOMATCH;
    }
    return templateMatchResult.length > 1 ? types_1.MatchType.TEMPLATED : types_1.MatchType.CONCRETE;
}
exports.matchBaseUrl = matchBaseUrl;
function convertTemplateToRegExp(urlTemplate, variables) {
    const regexp = !variables
        ? urlTemplate
        : urlTemplate.replace(variableRegexp, (_match, variableName) => {
            const variable = variables[variableName];
            if (!variable) {
                throw new Error(`Variable '${variableName}' is not defined, cannot parse input.`);
            }
            let { enum: enums } = variable;
            if (enums) {
                enums = enums.sort((a, b) => b.length - a.length);
            }
            return `(${enums && enums.length ? enums.join('|') : '.*?'})`;
        });
    return new RegExp(`^${regexp}$`);
}
exports.convertTemplateToRegExp = convertTemplateToRegExp;
function matchRequestUrlToTemplateUrl(requestUrl, templateUrl, variables) {
    const regexp = convertTemplateToRegExp(templateUrl, variables);
    return regexp.exec(requestUrl);
}
