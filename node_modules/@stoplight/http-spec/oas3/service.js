"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lodash_1 = require("lodash");
const guards_1 = require("./guards");
const securities_1 = require("./transformers/securities");
exports.transformOas3Service = ({ document }) => {
    var _a, _b, _c, _d, _e, _f;
    const servers = lodash_1.compact((_c = (_a = document.servers) === null || _a === void 0 ? void 0 : (_b = _a).map) === null || _c === void 0 ? void 0 : _c.call(_b, server => {
        var _a, _b;
        return server
            ? {
                name: (_b = (_a = document.info) === null || _a === void 0 ? void 0 : _a.title, (_b !== null && _b !== void 0 ? _b : '')),
                description: server.description,
                url: server.url,
            }
            : null;
    }));
    const security = lodash_1.compact(lodash_1.flatMap(document.security || [], sec => sec
        ? lodash_1.compact(Object.keys(sec).map(n => {
            var _a, _b, _c;
            const definition = (_c = (_b = (_a = document) === null || _a === void 0 ? void 0 : _a.components) === null || _b === void 0 ? void 0 : _b.securitySchemes) === null || _c === void 0 ? void 0 : _c[n];
            return guards_1.isSecurityScheme(definition) && securities_1.transformToSingleSecurity(definition);
        }))
        : null));
    const securitySchemes = lodash_1.compact(Object.values(((_d = document.components) === null || _d === void 0 ? void 0 : _d.securitySchemes) || [])
        .filter(lodash_1.isObject)
        .map(sec => (sec ? securities_1.transformToSingleSecurity(sec) : undefined)));
    return Object.assign(Object.assign({ id: '?http-service-id?', name: (_f = (_e = document.info) === null || _e === void 0 ? void 0 : _e.title, (_f !== null && _f !== void 0 ? _f : 'no-title')) }, document.info), { servers, tags: lodash_1.compact(document.tags || []), security,
        securitySchemes });
};
//# sourceMappingURL=service.js.map